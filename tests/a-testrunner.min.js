/**
 * @author Holmes Bryant <https://github.com/HolmesBryant>
 * @version 1.0.0
 * @license MIT
 */
class ATestresults extends HTMLElement{static eventComplete="a-complete";static eventResult="a-testresult";static eventProgress="a-progress";static verdictGroupStart="GROUP_START";static verdictGroupEnd="GROUP_END";static verdictInfo="INFO";#t;#e;#r;#s={};#o={};#a={pass:0,fail:0,error:0,total:0};#n=[];static#i=document.createElement("template");static{this.#i.innerHTML='\n      <style>\n        :host {\n          --bg1-color: snow; --bg2-color: linen; --border-color: silver;\n          --accent-color: dimgray; --text-color: rgb(40,40,40);\n          --pass: #28a745; --fail: #dc3545; --error: #e83e8c; --info: #fd7e14;\n          --border-radius: .25em; --gap: .5rem; --pad: 1rem;\n          display: block; font-family: monospace; font-size: 14px;\n          background-color: var(--bg1-color); border: 1px solid var(--border-color);\n          border-radius: var(--border-radius); overflow: hidden; color: var(--text-color);\n        }\n        :host(.verdict-pass) { border-color: var(--pass); }\n        :host(.verdict-fail), :host(.fail) { border-color: var(--fail); }\n        header, .row { border-bottom: 1px solid var(--border-color); }\n        pre, header { background-color: var(--bg2-color); }\n        pre { border-radius: var(--border-radius); }\n        #root > div:last-child { border-bottom: none; }\n        .pass { color: var(--pass); } .fail { color: var(--fail); } .error { color: var(--error); } .info { color: var(--info); }\n        summary { color: var(--accent-color); cursor: pointer; }\n        .group-title { padding: 4px 8px; transition: color 0.2s; }\n        .group-title.pass { color: var(--pass); }\n        .group-title.fail { color: var(--fail); }\n        .final, .group-title, .verdict, #summary, #title { font-weight: bold; }\n        .verdict { text-transform: uppercase; flex: 0 0 70px; }\n        header, .final, pre { padding: var(--pad); }\n        .gist { flex: 1; } .final { text-align: center; }\n        .group-content { margin-left: calc(var(--gap) * 2); padding-left: var(--pad); border-left: 3px solid var(--border-color); transition: border-color 0.2s; }\n        .group-content.pass { border-left-color: var(--pass); }\n        .group-content.fail { border-left-color: var(--fail); }\n        .row { display: flex; flex-direction: column; padding: 6px 4px; }\n        .main { display: flex; align-items: center; gap: var(--gap); }\n        #root { max-height: 70vh; overflow-y: auto; }\n\n        /* --- Progress Bar Styles --- */\n        #progress-container { display: flex; align-items: center; gap: 1em; margin-top: .75em; }\n        #progress-bar { flex: 1; -webkit-appearance: none; appearance: none; height: 10px; border: none; border-radius: var(--border-radius); overflow: hidden; }\n        #progress-bar::-webkit-progress-bar { background-color: #ced4da; }\n        #progress-bar::-moz-progress-bar { background-color: #ced4da; }\n        #progress-bar::-webkit-progress-value { background-color: var(--pass); transition: background-color 0.2s, width 0.2s; }\n        :host(.fail) #progress-bar::-webkit-progress-value { background-color: var(--fail); }\n        #progress-bar::-moz-progress-bar { background-color: var(--pass); transition: background-color 0.2s; }\n        :host(.fail) #progress-bar::-moz-progress-bar { background-color: var(--fail); }\n        #progress-text { flex: 0 0 180px; display: flex; justify-content: space-between; font-weight: bold; }\n      </style>\n      <header>\n        <div id="title"></div>\n        <div id="summary"></div>\n        <div id="progress-container">\n          <progress id="progress-bar" max="1" value="0"></progress>\n        </div>\n      </header>\n      <div id="root"></div>\n      <template id="tpl-group"><details class="group"><summary class="group-title"></summary><div class="group-content"></div></details></template>\n      <template id="tpl-info"><div class="row info"><div class="main"><span class="verdict">INFO</span><span class="gist"></span></div></div></template>\n      <template id="tpl-test"><div class="row"><div class="main"><span class="verdict"></span><span class="gist"></span></div><details><summary>Details</summary><pre><code></code></pre></details></div></template>\n    '}constructor(){super(),this.attachShadow({mode:"open"}),this.handleEvent=this.handleEvent.bind(this)}connectedCallback(){const t=ATestresults.#i.content.cloneNode(!0);this.#t=t.getElementById("root"),this.#e=t.getElementById("summary"),this.#r=t.getElementById("title"),this.#o.bar=t.getElementById("progress-bar"),this.#s.group=t.getElementById("tpl-group").content,this.#s.info=t.getElementById("tpl-info").content,this.#s.test=t.getElementById("tpl-test").content,this.shadowRoot.appendChild(t),this.#l(),this.addEventListener(ATestresults.eventResult,this.handleEvent),this.addEventListener(ATestresults.eventComplete,this.handleEvent),this.addEventListener(ATestresults.eventProgress,this.handleEvent)}disconnectedCallback(){this.removeEventListener(ATestresults.eventResult,this.handleEvent),this.removeEventListener(ATestresults.eventComplete,this.handleEvent),this.removeEventListener(ATestresults.eventProgress,this.handleEvent)}handleEvent(t){t.stopPropagation();const{detail:e}=t;switch(t.type){case ATestresults.eventComplete:return this.#d(e);case ATestresults.eventProgress:return this.#c(t);case ATestresults.eventResult:switch(e.verdict){case ATestresults.verdictGroupStart:return this.#p(e);case ATestresults.verdictGroupEnd:return this.#u();case ATestresults.verdictInfo:return this.#g(e);default:return this.#h(e)}}}#l(){this.#a={pass:0,fail:0,error:0,total:0},this.#n=[],this.#t.innerHTML="",this.className="",this.#o.bar.max=1,this.#o.bar.value=0,this.#r.textContent=this.getAttribute("title")||"Test Results",this.#v()}#c(t){const{loaded:e,total:r}=t;r>0&&(this.#o.bar.max=r,this.#o.bar.value=e)}#m(){return this.#n.length>0?this.#n[this.#n.length-1].container:this.#t}#p({gist:t}){const e=this.#s.group.cloneNode(!0),r=e.querySelector(".group-title"),s=e.querySelector(".group-content");r.textContent=t,this.#m().appendChild(e),this.#n.push({titleEl:r,container:s,verdict:"pass"})}#u(){const t=this.#n.pop();t&&(t.container.classList.add(t.verdict),t.titleEl.classList.add(t.verdict),"fail"===t.verdict&&this.#n.length>0&&(this.#n[this.#n.length-1].verdict="fail"))}#g({gist:t}){const e=this.#s.info.cloneNode(!0);e.querySelector(".gist").textContent=t,this.#m().appendChild(e)}#h(t){this.#a.total++;const e=t.verdict.toLowerCase();void 0!==this.#a[e]&&this.#a[e]++,("fail"===e||"error"===e)&&this.#n.length>0&&(this.#n[this.#n.length-1].verdict="fail");const r=this.#s.test.cloneNode(!0),s=r.querySelector(".row"),o=r.querySelector("details");if(s.classList.add(e),r.querySelector(".verdict").textContent=t.verdict,r.querySelector(".gist").textContent=t.gist,void 0!==t.result||void 0!==t.expect||t.line){const e=`Result:   ${this.#f(t.result)}\nExpected: ${this.#f(t.expect)}${t.line?`\nLine:     ${t.line}`:""}`;r.querySelector("code").textContent=e}else o.remove();this.#m().appendChild(r),this.#v()}#d({verdict:t}){"fail"===t&&this.classList.add("fail"),this.classList.add("finished",`verdict-${t}`);const e=document.createElement("div");e.className=`final ${t}`,e.textContent="DONE",this.#t.appendChild(e)}#f(t){return t instanceof Error?t.stack||t.message:"object"==typeof t&&null!==t?JSON.stringify(t,null,2):String(t)}#v(){this.#e.innerHTML=`\n      <span>Total:${this.#a.total}</span>&nbsp;\n      <span class="pass">Passed:${this.#a.pass}</span>&nbsp;\n      <span class="fail">Failed:${this.#a.fail}</span>&nbsp;\n      <span class="error">Errors:${this.#a.error}</span>\n    `}}customElements.get("a-testrunner")||customElements.define("a-testrunner",ATestresults);
